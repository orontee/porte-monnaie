{% extends 'tracker/base_authentified.html' %}
{% load i18n tracker_extras table humanize static %}
{% is_current_year year as is_current %}

{% block style %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/graph.css' %}">
{% endblock style %}

{% block header %}
<h2>
  {% blocktrans with date=year|date:'Y' %}Report for {{ date }}{% endblocktrans %}
</h2>
{% endblock header %}

{% block content %}
<div id="pager">
  <small>
    <ul class="pager">
      <li class="previous">
	<a href="{% url 'tracker:summary' previous_year.year %}">
	  &larr; {% trans 'previous'|capfirst %}
	</a>
      </li>
      <li class="next">
	<a href="{% url 'tracker:summary' next_year.year %}">
	  {% trans 'next'|capfirst %} &rarr;
	</a>
      </li>
    </ul>
  </small>
</div>
<div id="main">
  {% if amounts %}
  <p>
    {% if is_current %}
    {% blocktrans %}The following table outlines your expenditures for the current year.{% endblocktrans %}
    {% else %}
    {% blocktrans with date=year|date:'Y' %}The following table outlines your expenditures for {{ date }}.{% endblocktrans %}
    {% endif %}
  </p>
  <div class="table-responsive">
    <table class="table table-hover table-bordered table-striped">
      <thead>
	<tr>
	  <th class="month">
	    {% trans 'month'|capfirst %}
	  </th>
	  <th class="amount">
	    {% trans 'amount'|capfirst %}
	  </th>
	  {% if shared_purse %}
	  <th class="average">
	    {% trans 'average'|capfirst %}
	  </th>
	  <th class="delta">
	    {% trans 'delta'|capfirst %}
	  </th>
	  {% endif %}
	</tr>
      </thead>
      <tbody>
	{% for a in amounts %}
	<tr>
	  <td class="month">
	    <a class="month-anchor" 
	       href="{% url 'tracker:archive' year=year.year month=a.month.month %}">
	      {{ a.month|date:'F'|capfirst }}
	    </a>
	  </td>
	  <td class="amount">
	    {{ a.amount|floatformat:2 }}
	  </td>
	  {% if shared_purse %}
	  <td class="average">
	    {{ a.average|floatformat:2 }}
	  </td>
	  <td class="delta">
	    {{ a.delta|floatformat:2 }}
	  </td>
	  {% endif %}
	</tr>
	{% endfor %}
	<tr class="total">
	  <td>
	    {% trans 'totals'|capfirst %}
	  </td>
	  <td class="amount">
	    {{ totals.amount|floatformat:2 }}
	  </td>
	  {% if shared_purse %}
	  <td class="average">
	    {{ totals.average|floatformat:2 }}
	  </td>
	  <td class="delta">
	    {{ totals.delta|floatformat:2 }}
	  </td>
	  {% endif %}
	</tr>
      </tbody>
    </table>
  </div>
  <div class="container">
    <div class="row">
      <div class="col-lg-6">
	<h2>{% trans 'tags'|capfirst %}</h2>
	<div id="tags-body">
	</div>
      </div>
      <div class="hidden-xs col-lg-6">
	<h2>{% trans 'histogram'|capfirst %}</h2>
	<div id="graph-body">
	</div>
      </div>
    </div>
  </div>
  {% else %}
  <p>
    {% blocktrans with date=year|date:'Y' %}No expenditures found in {{ date }}!{% endblocktrans %}
  </p>
  {% endif %}
</div>
{% endblock content %}

{% block scripts %}
{{ block.super }}
<script src="{% url 'django.views.i18n.javascript_catalog' %}"></script>
<script src="{% static 'js/d3.min.js' %}"></script>
<script src="{% static 'js/graph.js' %}"></script>
<script type="text/javascript">
var activeTool = document.getElementById('report');
if (activeTool != null) {
   activeTool.parentNode.className += 'active';
}
var words = [{% for t in tags %}{text:"{{ t.name }}", url:"/tracker/expenditures/search/?filter={{ t.name }}", size: "{{ t.amount }}" }{% if not forloop.last %},{% endif %}{% endfor %}]
</script>
<script src="{% static 'js/d3.layout.cloud.js' %}"></script>
<script src="{% static 'js/tags.js' %}"></script>
{% endblock scripts %}
